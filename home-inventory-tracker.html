<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home Inventory Tracker - Insurance Documentation</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Crimson+Pro:wght@400;600;700&family=Work+Sans:wght@400;500;600&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary: #1e3a5f;
            --primary-light: #2c5282;
            --accent: #d4af37;
            --background: #f8f9fa;
            --card-bg: #ffffff;
            --text: #2d3748;
            --text-light: #718096;
            --border: #e2e8f0;
            --success: #48bb78;
            --warning: #ed8936;
            --shadow: rgba(0, 0, 0, 0.1);
        }
        
        body {
            font-family: 'Work Sans', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: var(--text);
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .header {
            background: var(--card-bg);
            padding: 2rem;
            border-radius: 16px;
            box-shadow: 0 10px 40px var(--shadow);
            margin-bottom: 2rem;
            border-left: 6px solid var(--accent);
        }
        
        .header h1 {
            font-family: 'Crimson Pro', serif;
            font-size: 2.5rem;
            color: var(--primary);
            margin-bottom: 0.5rem;
            font-weight: 700;
        }
        
        .header p {
            color: var(--text-light);
            font-size: 1.1rem;
        }
        
        .stats-bar {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: var(--card-bg);
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 4px 12px var(--shadow);
            text-align: center;
            border-top: 4px solid var(--accent);
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
            font-family: 'Crimson Pro', serif;
        }
        
        .stat-label {
            color: var(--text-light);
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }
        
        .controls {
            background: var(--card-bg);
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 4px 12px var(--shadow);
            margin-bottom: 2rem;
        }
        
        .button-group {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin-bottom: 1rem;
        }
        
        button {
            background: var(--primary);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-family: 'Work Sans', sans-serif;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px var(--shadow);
        }
        
        button:hover {
            background: var(--primary-light);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px var(--shadow);
        }
        
        .btn-accent {
            background: var(--accent);
            color: var(--primary);
        }
        
        .btn-accent:hover {
            background: #c9a22e;
        }
        
        .btn-secondary {
            background: var(--text-light);
        }
        
        .btn-secondary:hover {
            background: #4a5568;
        }
        
        .search-filter {
            display: grid;
            grid-template-columns: 1fr 200px 200px;
            gap: 1rem;
            margin-top: 1rem;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-family: 'Work Sans', sans-serif;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            overflow-y: auto;
            padding: 2rem;
        }
        
        .modal-content {
            background: var(--card-bg);
            max-width: 800px;
            margin: 0 auto;
            border-radius: 16px;
            padding: 2rem;
            position: relative;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }
        
        .close-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: var(--text-light);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 1.5rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .form-group {
            margin-bottom: 1rem;
        }
        
        .form-group.full-width {
            grid-column: 1 / -1;
        }
        
        label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--primary);
            font-weight: 500;
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .checkbox-group input[type="checkbox"] {
            width: auto;
        }
        
        .photo-upload {
            border: 3px dashed var(--border);
            border-radius: 12px;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: var(--background);
        }
        
        .photo-upload:hover {
            border-color: var(--primary);
            background: #edf2f7;
        }
        
        .photo-preview {
            max-width: 100%;
            max-height: 300px;
            margin-top: 1rem;
            border-radius: 8px;
            box-shadow: 0 4px 12px var(--shadow);
        }
        
        .items-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 1.5rem;
        }
        
        .item-card {
            background: var(--card-bg);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 12px var(--shadow);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border-top: 4px solid var(--primary);
        }
        
        .item-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px var(--shadow);
        }
        
        .item-photo {
            width: 100%;
            height: 200px;
            object-fit: cover;
            background: var(--background);
        }
        
        .item-content {
            padding: 1.5rem;
        }
        
        .item-name {
            font-family: 'Crimson Pro', serif;
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }
        
        .item-price {
            font-size: 1.5rem;
            color: var(--accent);
            font-weight: 700;
            margin-bottom: 1rem;
        }
        
        .item-details {
            font-size: 0.9rem;
            color: var(--text-light);
            margin-bottom: 0.5rem;
        }
        
        .item-details strong {
            color: var(--text);
        }
        
        .item-category {
            display: inline-block;
            background: var(--primary);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            margin-top: 0.5rem;
        }
        
        .gift-badge {
            display: inline-block;
            background: var(--success);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            margin-left: 0.5rem;
        }
        
        .item-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }
        
        .item-actions button {
            flex: 1;
            padding: 0.5rem;
            font-size: 0.9rem;
        }
        
        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            background: var(--card-bg);
            border-radius: 12px;
            box-shadow: 0 4px 12px var(--shadow);
        }
        
        .empty-state h2 {
            font-family: 'Crimson Pro', serif;
            color: var(--primary);
            font-size: 2rem;
            margin-bottom: 1rem;
        }
        
        .empty-state p {
            color: var(--text-light);
            font-size: 1.1rem;
        }
        
        .qr-code-container {
            text-align: center;
            padding: 1rem;
            background: white;
            border-radius: 8px;
            margin-top: 1rem;
        }
        
        .qr-code-container canvas {
            border: 2px solid var(--border);
            border-radius: 8px;
            padding: 0.5rem;
        }
        
        .item-qr {
            text-align: center;
            padding: 1rem;
            background: var(--background);
            border-radius: 8px;
            margin-top: 1rem;
        }
        
        .item-qr canvas {
            max-width: 100%;
            height: auto !important;
        }
        
        .label-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.5rem;
            margin: 2rem 0;
        }
        
        .label-preview {
            border: 2px solid var(--border);
            padding: 1rem;
            text-align: center;
            background: white;
            border-radius: 8px;
        }
        
        .label-preview h3 {
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
            color: var(--primary);
        }
        
        .label-preview canvas {
            margin: 0 auto;
        }
        
        .label-info {
            font-size: 0.7rem;
            margin-top: 0.5rem;
            color: var(--text-light);
        }
        
        .scanner-container {
            position: relative;
            width: 100%;
            max-width: 500px;
            margin: 2rem auto;
            background: var(--background);
            border-radius: 12px;
            overflow: hidden;
        }
        
        #scannerVideo {
            width: 100%;
            height: auto;
            display: block;
        }
        
        .scanner-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 250px;
            height: 250px;
            border: 3px solid var(--accent);
            border-radius: 12px;
            box-shadow: 0 0 0 9999px rgba(0, 0, 0, 0.5);
        }
        
        .scanner-instructions {
            text-align: center;
            padding: 1rem;
            color: var(--text-light);
        }
        
        .manual-lookup {
            margin-top: 2rem;
            padding: 1.5rem;
            background: var(--background);
            border-radius: 12px;
        }
        
        @media print {
            body {
                background: white;
            }
            
            .controls, .button-group, .modal {
                display: none !important;
            }
            
            .item-card {
                break-inside: avoid;
                page-break-inside: avoid;
            }
            
            .label-preview {
                break-inside: avoid;
                page-break-inside: avoid;
            }
        }
        
        @media (max-width: 768px) {
            .search-filter {
                grid-template-columns: 1fr;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .items-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè† Home Inventory Tracker</h1>
            <p>Professional asset documentation for insurance and personal records</p>
        </div>
        
        <div class="stats-bar">
            <div class="stat-card">
                <div class="stat-value" id="totalItems">0</div>
                <div class="stat-label">Total Items</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="totalValue">$0.00</div>
                <div class="stat-label">Total Value</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="giftCount">0</div>
                <div class="stat-label">Gifts Received</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="categoryCount">0</div>
                <div class="stat-label">Categories</div>
            </div>
        </div>
        
        <div class="controls">
            <div class="button-group">
                <button onclick="openAddModal()" class="btn-accent">‚ûï Add New Item</button>
                <button onclick="openLabelModal()" class="btn-accent">üè∑Ô∏è Print Labels</button>
                <button onclick="openScannerModal()" class="btn-accent">üì∑ Scan QR Code</button>
                <button onclick="exportToJSON()">üíæ Export Data</button>
                <button onclick="importFromJSON()">üì• Import Data</button>
                <button onclick="printInventory()">üñ®Ô∏è Print Inventory</button>
                <button onclick="clearAll()" class="btn-secondary">üóëÔ∏è Clear All</button>
            </div>
            
            <div class="search-filter">
                <input type="text" id="searchInput" placeholder="üîç Search items..." oninput="filterItems()">
                <select id="categoryFilter" onchange="filterItems()">
                    <option value="">All Categories</option>
                </select>
                <select id="roomFilter" onchange="filterItems()">
                    <option value="">All Rooms</option>
                </select>
            </div>
        </div>
        
        <div id="itemsContainer" class="items-grid"></div>
        
        <div class="empty-state" id="emptyState">
            <h2>No Items Yet</h2>
            <p>Start building your home inventory by adding your first item!</p>
        </div>
    </div>
    
    <!-- Add/Edit Modal -->
    <div id="itemModal" class="modal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeModal()">√ó</button>
            <h2 style="font-family: 'Crimson Pro', serif; color: var(--primary); margin-bottom: 2rem;" id="modalTitle">Add New Item</h2>
            
            <form id="itemForm" onsubmit="saveItem(event)">
                <div class="form-group full-width">
                    <label>Item Photo</label>
                    <div class="photo-upload" onclick="document.getElementById('photoInput').click()">
                        <div id="photoPlaceholder">üì∑ Click to upload photo</div>
                        <img id="photoPreview" class="photo-preview" style="display: none;">
                    </div>
                    <input type="file" id="photoInput" accept="image/*" style="display: none;" onchange="handlePhotoUpload(event)">
                </div>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label>Item Name *</label>
                        <input type="text" id="itemName" required>
                    </div>
                    
                    <div class="form-group">
                        <label>Purchase Price *</label>
                        <input type="number" id="itemPrice" step="0.01" required placeholder="0.00">
                    </div>
                    
                    <div class="form-group">
                        <label>Category</label>
                        <select id="itemCategory">
                            <option value="Electronics">Electronics</option>
                            <option value="Appliances">Appliances</option>
                            <option value="Furniture">Furniture</option>
                            <option value="Jewelry">Jewelry</option>
                            <option value="Tools">Tools</option>
                            <option value="Sports Equipment">Sports Equipment</option>
                            <option value="Musical Instruments">Musical Instruments</option>
                            <option value="Art & Collectibles">Art & Collectibles</option>
                            <option value="Kitchen">Kitchen</option>
                            <option value="Office Equipment">Office Equipment</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Room/Location</label>
                        <select id="itemRoom">
                            <option value="Living Room">Living Room</option>
                            <option value="Bedroom">Bedroom</option>
                            <option value="Kitchen">Kitchen</option>
                            <option value="Dining Room">Dining Room</option>
                            <option value="Office">Office</option>
                            <option value="Garage">Garage</option>
                            <option value="Basement">Basement</option>
                            <option value="Attic">Attic</option>
                            <option value="Bathroom">Bathroom</option>
                            <option value="Storage">Storage</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Model Number</label>
                        <input type="text" id="itemModel">
                    </div>
                    
                    <div class="form-group">
                        <label>Serial Number</label>
                        <input type="text" id="itemSerial">
                    </div>
                    
                    <div class="form-group">
                        <label>Purchase Date</label>
                        <input type="date" id="itemDate">
                    </div>
                    
                    <div class="form-group">
                        <label>Store/Website Purchased</label>
                        <input type="text" id="itemStore">
                    </div>
                    
                    <div class="form-group full-width">
                        <label>Protection Plan/Warranty Info</label>
                        <textarea id="itemWarranty" rows="2"></textarea>
                    </div>
                    
                    <div class="form-group full-width">
                        <label>Additional Notes</label>
                        <textarea id="itemNotes" rows="3" placeholder="Condition, replacement value, special features, etc."></textarea>
                    </div>
                    
                    <div class="form-group full-width checkbox-group">
                        <input type="checkbox" id="itemGift">
                        <label for="itemGift" style="margin: 0;">This item was received as a gift</label>
                    </div>
                    
                    <div class="form-group full-width" id="modalQrContainer" style="display: none;">
                        <label>QR Code for This Item</label>
                        <div class="qr-code-container">
                            <div id="modalQrCode"></div>
                            <p style="margin-top: 0.5rem; color: var(--text-light); font-size: 0.9rem;">Scan this code to quickly access item details</p>
                        </div>
                    </div>
                </div>
                
                <div class="button-group">
                    <button type="submit" class="btn-accent">üíæ Save Item</button>
                    <button type="button" onclick="closeModal()" class="btn-secondary">Cancel</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Label Printing Modal -->
    <div id="labelModal" class="modal">
        <div class="modal-content" style="max-width: 900px;">
            <button class="close-btn" onclick="closeLabelModal()">√ó</button>
            <h2 style="font-family: 'Crimson Pro', serif; color: var(--primary); margin-bottom: 1rem;">Print Item Labels</h2>
            <p style="color: var(--text-light); margin-bottom: 2rem;">Select items to print QR code labels for easy scanning and identification</p>
            
            <div class="form-group">
                <label>Label Format</label>
                <select id="labelFormat" onchange="updateLabelPreview()">
                    <option value="single">Single Item Label (2" x 3")</option>
                    <option value="small">Small Label (1.5" x 1.5")</option>
                    <option value="avery">Avery 5160 (2.625" x 1") - 30 per sheet</option>
                    <option value="box">Box Label (4" x 6") - Contents List</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>Select Items to Print</label>
                <div style="max-height: 200px; overflow-y: auto; border: 2px solid var(--border); border-radius: 8px; padding: 1rem;">
                    <div id="labelItemList"></div>
                </div>
            </div>
            
            <div id="labelPreview" class="label-grid"></div>
            
            <div class="button-group">
                <button onclick="printLabels()" class="btn-accent">üñ®Ô∏è Print Selected Labels</button>
                <button onclick="closeLabelModal()" class="btn-secondary">Cancel</button>
            </div>
        </div>
    </div>
    
    <!-- QR Scanner Modal -->
    <div id="scannerModal" class="modal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeScannerModal()">√ó</button>
            <h2 style="font-family: 'Crimson Pro', serif; color: var(--primary); margin-bottom: 1rem;">Scan QR Code</h2>
            
            <div class="scanner-instructions">
                <p>Position the QR code within the frame to view item details</p>
            </div>
            
            <div class="scanner-container">
                <video id="scannerVideo" style="display: none;"></video>
                <canvas id="scannerCanvas" style="display: none;"></canvas>
                <div class="scanner-overlay"></div>
            </div>
            
            <div class="manual-lookup">
                <h3 style="color: var(--primary); margin-bottom: 1rem;">Or Enter Item ID Manually</h3>
                <div style="display: flex; gap: 1rem;">
                    <input type="text" id="manualItemId" placeholder="Enter item ID (e.g., 1704678901234)">
                    <button onclick="lookupItemById()">üîç Find</button>
                </div>
            </div>
            
            <div class="button-group">
                <button onclick="startScanning()" id="startScanBtn" class="btn-accent">üì∑ Start Camera</button>
                <button onclick="closeScannerModal()" class="btn-secondary">Close</button>
            </div>
        </div>
    </div>
    
    <input type="file" id="importInput" accept=".json" style="display: none;" onchange="handleImport(event)">
    
    <script>
        let inventory = JSON.parse(localStorage.getItem('homeInventory')) || [];
        let currentEditIndex = null;
        let currentPhoto = null;
        
        function init() {
            renderItems();
            updateStats();
            updateFilters();
        }
        
        function openAddModal() {
            currentEditIndex = null;
            currentPhoto = null;
            document.getElementById('modalTitle').textContent = 'Add New Item';
            document.getElementById('itemForm').reset();
            document.getElementById('photoPreview').style.display = 'none';
            document.getElementById('photoPlaceholder').style.display = 'block';
            document.getElementById('modalQrContainer').style.display = 'none';
            document.getElementById('itemModal').style.display = 'block';
        }
        
        function closeModal() {
            document.getElementById('itemModal').style.display = 'none';
        }
        
        function handlePhotoUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    currentPhoto = e.target.result;
                    document.getElementById('photoPreview').src = currentPhoto;
                    document.getElementById('photoPreview').style.display = 'block';
                    document.getElementById('photoPlaceholder').style.display = 'none';
                };
                reader.readAsDataURL(file);
            }
        }
        
        function saveItem(event) {
            event.preventDefault();
            
            const item = {
                id: currentEditIndex !== null ? inventory[currentEditIndex].id : Date.now(),
                name: document.getElementById('itemName').value,
                price: parseFloat(document.getElementById('itemPrice').value),
                category: document.getElementById('itemCategory').value,
                room: document.getElementById('itemRoom').value,
                model: document.getElementById('itemModel').value,
                serial: document.getElementById('itemSerial').value,
                date: document.getElementById('itemDate').value,
                store: document.getElementById('itemStore').value,
                warranty: document.getElementById('itemWarranty').value,
                notes: document.getElementById('itemNotes').value,
                gift: document.getElementById('itemGift').checked,
                photo: currentPhoto || (currentEditIndex !== null ? inventory[currentEditIndex].photo : null)
            };
            
            if (currentEditIndex !== null) {
                inventory[currentEditIndex] = item;
            } else {
                inventory.push(item);
            }
            
            localStorage.setItem('homeInventory', JSON.stringify(inventory));
            closeModal();
            renderItems();
            updateStats();
            updateFilters();
        }
        
        function editItem(index) {
            currentEditIndex = index;
            const item = inventory[index];
            
            document.getElementById('modalTitle').textContent = 'Edit Item';
            document.getElementById('itemName').value = item.name;
            document.getElementById('itemPrice').value = item.price;
            document.getElementById('itemCategory').value = item.category;
            document.getElementById('itemRoom').value = item.room;
            document.getElementById('itemModel').value = item.model || '';
            document.getElementById('itemSerial').value = item.serial || '';
            document.getElementById('itemDate').value = item.date || '';
            document.getElementById('itemStore').value = item.store || '';
            document.getElementById('itemWarranty').value = item.warranty || '';
            document.getElementById('itemNotes').value = item.notes || '';
            document.getElementById('itemGift').checked = item.gift;
            
            if (item.photo) {
                currentPhoto = item.photo;
                document.getElementById('photoPreview').src = item.photo;
                document.getElementById('photoPreview').style.display = 'block';
                document.getElementById('photoPlaceholder').style.display = 'none';
            } else {
                document.getElementById('photoPreview').style.display = 'none';
                document.getElementById('photoPlaceholder').style.display = 'block';
            }
            
            // Show QR code for existing item
            document.getElementById('modalQrContainer').style.display = 'block';
            setTimeout(() => {
                const qrContainer = document.getElementById('modalQrCode');
                qrContainer.innerHTML = '';
                new QRCode(qrContainer, {
                    text: `ITEM:${item.id}`,
                    width: 150,
                    height: 150,
                    colorDark: "#1e3a5f",
                    colorLight: "#ffffff",
                    correctLevel: QRCode.CorrectLevel.H
                });
            }, 100);
            
            document.getElementById('itemModal').style.display = 'block';
        }
        
        function deleteItem(index) {
            if (confirm('Are you sure you want to delete this item?')) {
                inventory.splice(index, 1);
                localStorage.setItem('homeInventory', JSON.stringify(inventory));
                renderItems();
                updateStats();
                updateFilters();
            }
        }
        
        function renderItems() {
            const container = document.getElementById('itemsContainer');
            const emptyState = document.getElementById('emptyState');
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const categoryFilter = document.getElementById('categoryFilter').value;
            const roomFilter = document.getElementById('roomFilter').value;
            
            let filteredItems = inventory.filter(item => {
                const matchesSearch = item.name.toLowerCase().includes(searchTerm) ||
                                    (item.model && item.model.toLowerCase().includes(searchTerm)) ||
                                    (item.serial && item.serial.toLowerCase().includes(searchTerm));
                const matchesCategory = !categoryFilter || item.category === categoryFilter;
                const matchesRoom = !roomFilter || item.room === roomFilter;
                
                return matchesSearch && matchesCategory && matchesRoom;
            });
            
            if (filteredItems.length === 0) {
                container.style.display = 'none';
                emptyState.style.display = 'block';
                if (searchTerm || categoryFilter || roomFilter) {
                    emptyState.querySelector('h2').textContent = 'No Items Found';
                    emptyState.querySelector('p').textContent = 'Try adjusting your search or filters.';
                } else {
                    emptyState.querySelector('h2').textContent = 'No Items Yet';
                    emptyState.querySelector('p').textContent = 'Start building your home inventory by adding your first item!';
                }
            } else {
                container.style.display = 'grid';
                emptyState.style.display = 'none';
            }
            
            container.innerHTML = filteredItems.map((item, index) => {
                const actualIndex = inventory.indexOf(item);
                return `
                    <div class="item-card">
                        ${item.photo ? `<img src="${item.photo}" alt="${item.name}" class="item-photo">` : '<div class="item-photo" style="display: flex; align-items: center; justify-content: center; font-size: 3rem; color: #cbd5e0;">üì∑</div>'}
                        <div class="item-content">
                            <div class="item-name">${item.name}</div>
                            <div class="item-price">$${item.price.toFixed(2)}</div>
                            
                            ${item.model ? `<div class="item-details"><strong>Model:</strong> ${item.model}</div>` : ''}
                            ${item.serial ? `<div class="item-details"><strong>Serial:</strong> ${item.serial}</div>` : ''}
                            ${item.date ? `<div class="item-details"><strong>Purchased:</strong> ${new Date(item.date).toLocaleDateString()}</div>` : ''}
                            ${item.store ? `<div class="item-details"><strong>From:</strong> ${item.store}</div>` : ''}
                            ${item.warranty ? `<div class="item-details"><strong>Warranty:</strong> ${item.warranty}</div>` : ''}
                            ${item.notes ? `<div class="item-details"><strong>Notes:</strong> ${item.notes}</div>` : ''}
                            
                            <div>
                                <span class="item-category">${item.category}</span>
                                <span class="item-category">${item.room}</span>
                                ${item.gift ? '<span class="gift-badge">üéÅ Gift</span>' : ''}
                            </div>
                            
                            <div class="item-qr">
                                <div id="qr-${item.id}" style="display: inline-block;"></div>
                                <div class="label-info">Item ID: ${item.id}</div>
                            </div>
                            
                            <div class="item-actions">
                                <button onclick="editItem(${actualIndex})">‚úèÔ∏è Edit</button>
                                <button onclick="deleteItem(${actualIndex})" class="btn-secondary">üóëÔ∏è Delete</button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            // Generate QR codes after rendering
            setTimeout(() => {
                filteredItems.forEach(item => {
                    const qrContainer = document.getElementById(`qr-${item.id}`);
                    if (qrContainer) {
                        qrContainer.innerHTML = '';
                        new QRCode(qrContainer, {
                            text: `ITEM:${item.id}`,
                            width: 120,
                            height: 120,
                            colorDark: "#1e3a5f",
                            colorLight: "#ffffff",
                            correctLevel: QRCode.CorrectLevel.H
                        });
                    }
                });
            }, 100);
        }
        
        function updateStats() {
            const totalValue = inventory.reduce((sum, item) => sum + item.price, 0);
            const giftCount = inventory.filter(item => item.gift).length;
            const categories = new Set(inventory.map(item => item.category)).size;
            
            document.getElementById('totalItems').textContent = inventory.length;
            document.getElementById('totalValue').textContent = `$${totalValue.toFixed(2)}`;
            document.getElementById('giftCount').textContent = giftCount;
            document.getElementById('categoryCount').textContent = categories;
        }
        
        function updateFilters() {
            const categoryFilter = document.getElementById('categoryFilter');
            const roomFilter = document.getElementById('roomFilter');
            
            const categories = [...new Set(inventory.map(item => item.category))].sort();
            const rooms = [...new Set(inventory.map(item => item.room))].sort();
            
            const currentCategory = categoryFilter.value;
            const currentRoom = roomFilter.value;
            
            categoryFilter.innerHTML = '<option value="">All Categories</option>' +
                categories.map(cat => `<option value="${cat}">${cat}</option>`).join('');
            
            roomFilter.innerHTML = '<option value="">All Rooms</option>' +
                rooms.map(room => `<option value="${room}">${room}</option>`).join('');
            
            categoryFilter.value = currentCategory;
            roomFilter.value = currentRoom;
        }
        
        function filterItems() {
            renderItems();
        }
        
        function exportToJSON() {
            const dataStr = JSON.stringify(inventory, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `home-inventory-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            URL.revokeObjectURL(url);
        }
        
        function importFromJSON() {
            document.getElementById('importInput').click();
        }
        
        function handleImport(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const importedData = JSON.parse(e.target.result);
                        if (confirm(`Import ${importedData.length} items? This will replace your current inventory.`)) {
                            inventory = importedData;
                            localStorage.setItem('homeInventory', JSON.stringify(inventory));
                            renderItems();
                            updateStats();
                            updateFilters();
                            alert('Import successful!');
                        }
                    } catch (error) {
                        alert('Error importing file. Please check the file format.');
                    }
                };
                reader.readAsText(file);
            }
        }
        
        function printInventory() {
            window.print();
        }
        
        function clearAll() {
            if (confirm('Are you sure you want to delete ALL items? This cannot be undone!')) {
                if (confirm('Really? This will permanently delete everything!')) {
                    inventory = [];
                    localStorage.setItem('homeInventory', JSON.stringify(inventory));
                    renderItems();
                    updateStats();
                    updateFilters();
                }
            }
        }
        
        // Label Printing Functions
        function openLabelModal() {
            document.getElementById('labelModal').style.display = 'block';
            updateLabelItemList();
            updateLabelPreview();
        }
        
        function closeLabelModal() {
            document.getElementById('labelModal').style.display = 'none';
        }
        
        function updateLabelItemList() {
            const container = document.getElementById('labelItemList');
            container.innerHTML = inventory.map((item, index) => `
                <div style="margin-bottom: 0.5rem;">
                    <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                        <input type="checkbox" class="label-item-check" data-index="${index}" onchange="updateLabelPreview()">
                        <span>${item.name} - ${item.room}</span>
                    </label>
                </div>
            `).join('');
        }
        
        function updateLabelPreview() {
            const selectedIndexes = Array.from(document.querySelectorAll('.label-item-check:checked'))
                .map(cb => parseInt(cb.dataset.index));
            
            const format = document.getElementById('labelFormat').value;
            const previewContainer = document.getElementById('labelPreview');
            
            if (selectedIndexes.length === 0) {
                previewContainer.innerHTML = '<p style="text-align: center; color: var(--text-light); grid-column: 1/-1;">Select items to preview labels</p>';
                return;
            }
            
            previewContainer.innerHTML = selectedIndexes.map(index => {
                const item = inventory[index];
                return `
                    <div class="label-preview">
                        <h3>${item.name}</h3>
                        <div id="label-qr-${item.id}"></div>
                        <div class="label-info">
                            ${item.room} | $${item.price.toFixed(2)}<br>
                            ID: ${item.id}
                        </div>
                    </div>
                `;
            }).join('');
            
            // Generate QR codes for labels
            setTimeout(() => {
                selectedIndexes.forEach(index => {
                    const item = inventory[index];
                    const qrContainer = document.getElementById(`label-qr-${item.id}`);
                    if (qrContainer) {
                        qrContainer.innerHTML = '';
                        const size = format === 'small' ? 80 : format === 'avery' ? 60 : 100;
                        new QRCode(qrContainer, {
                            text: `ITEM:${item.id}`,
                            width: size,
                            height: size,
                            colorDark: "#1e3a5f",
                            colorLight: "#ffffff",
                            correctLevel: QRCode.CorrectLevel.H
                        });
                    }
                });
            }, 100);
        }
        
        function printLabels() {
            window.print();
        }
        
        // QR Scanner Functions
        let scannerStream = null;
        let scannerInterval = null;
        
        function openScannerModal() {
            document.getElementById('scannerModal').style.display = 'block';
        }
        
        function closeScannerModal() {
            if (scannerStream) {
                scannerStream.getTracks().forEach(track => track.stop());
                scannerStream = null;
            }
            if (scannerInterval) {
                clearInterval(scannerInterval);
                scannerInterval = null;
            }
            document.getElementById('scannerModal').style.display = 'none';
            document.getElementById('scannerVideo').style.display = 'none';
        }
        
        async function startScanning() {
            try {
                const video = document.getElementById('scannerVideo');
                const canvas = document.getElementById('scannerCanvas');
                const context = canvas.getContext('2d');
                
                scannerStream = await navigator.mediaDevices.getUserMedia({ 
                    video: { facingMode: 'environment' } 
                });
                
                video.srcObject = scannerStream;
                video.style.display = 'block';
                video.play();
                
                document.getElementById('startScanBtn').textContent = 'üîÑ Scanning...';
                document.getElementById('startScanBtn').disabled = true;
                
                // Simple scanning approach - look for ITEM: pattern in manual entry
                alert('Camera scanning requires additional libraries. Please use the "Enter Item ID Manually" field below to look up items by their ID number.');
                
                closeScannerModal();
                
            } catch (error) {
                alert('Camera access denied or not available. Please use manual ID entry instead.');
            }
        }
        
        function lookupItemById() {
            const manualId = document.getElementById('manualItemId').value.trim();
            if (!manualId) {
                alert('Please enter an item ID');
                return;
            }
            
            // Handle both formats: "ITEM:123456" or just "123456"
            const itemId = manualId.replace('ITEM:', '');
            const itemIndex = inventory.findIndex(i => i.id.toString() === itemId);
            
            if (itemIndex !== -1) {
                closeScannerModal();
                // Open the item in edit mode to show full details
                editItem(itemIndex);
            } else {
                alert('Item not found. Please check the ID and try again.');
            }
        }
        
        init();
    </script>
</body>
</html>